INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})

SET(PYRANHA_INSTALL_PATH ${PYTHON_MODULES_PATH}/pyranha)

ADD_LIBRARY(_core SHARED core.cpp python_converters.hpp exceptions.hpp series_exposer.hpp exposer.hpp)
# Prefix and visibility setup.
SET_TARGET_PROPERTIES(_core PROPERTIES PREFIX "" COMPILE_DEFINITIONS "PIRANHA_USING_DLL")
IF(PYDEXTENSION)
	SET_TARGET_PROPERTIES(_core PROPERTIES SUFFIX ".pyd")
ENDIF(PYDEXTENSION)

# Strict aliasing setup.
IF(${PYTHON_LIBRARY_VERSION} LESS 30 AND CMAKE_COMPILER_IS_GNUCXX)
	SET_TARGET_PROPERTIES(_core PROPERTIES COMPILE_FLAGS "-fno-strict-aliasing" LINK_FLAGS "-fno-strict-aliasing")
ENDIF(${PYTHON_LIBRARY_VERSION} LESS 30 AND CMAKE_COMPILER_IS_GNUCXX)

# Module needs to Boost.Python and the Python libs, plus the mandatory libraries.
TARGET_LINK_LIBRARIES(_core ${MANDATORY_LIBRARIES} ${Boost_PYTHON_LIBRARY} ${PYTHON_LIBRARIES})
INSTALL(TARGETS _core
	RUNTIME DESTINATION ${PYRANHA_INSTALL_PATH}
	LIBRARY DESTINATION ${PYRANHA_INSTALL_PATH}
)

# Add the global init file.
INSTALL(FILES __init__.py _common.py polynomial.py poisson_series.py celmec.py math.py test.py DESTINATION ${PYRANHA_INSTALL_PATH})
